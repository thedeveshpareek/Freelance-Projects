{"ast":null,"code":"import _regeneratorRuntime from\"/home/codegama/bhawya/source_code/fx-frontend-base/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/codegama/bhawya/source_code/fx-frontend-base/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import{translate,t}from\"react-multi-lang\";import{Link}from\"react-router-dom\";import AgoraRTC from\"agora-rtc-sdk-ng\";import{Form,Button,Container,Row,Col,Table,Media,Image}from\"react-bootstrap\";import{liveViewerUpdateStart,liveVideoEndStart}from\"../../store/actions/LiveVideoAction\";import configuration from\"react-global-configuration\";var client=AgoraRTC.createClient({mode:\"live\",codec:\"vp8\"});var $=window.$;var AgoraLive=function AgoraLive(props){var rtc={// For the local client.\nclient:null,// For the local audio and video tracks.\nlocalAudioTrack:null,localVideoTrack:null};var localTrackState={videoTrackEnabled:true,audioTrackEnabled:true};var options={// Pass your app ID here.\nappId:configuration.get(\"configData.agora_app_id\"),// set UID\nuid:props.isOwner?1:0,// Set the channel name.\nchannel:props.liveVideo.data.virtual_id,// Pass a token if your project enables the App Certificate.\ntoken:props.liveVideo.data.agora_token?props.liveVideo.data.agora_token:null,// Set the user role in the channel. // \"audience\"\nrole:props.isOwner?\"host\":\"audience\"};var remoteUsers={};function startBasicCall(){return _startBasicCall.apply(this,arguments);}function _startBasicCall(){_startBasicCall=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var uid;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:rtc.client=AgoraRTC.createClient({mode:\"rtc\",codec:\"vp8\"});client.setClientRole(options.role);rtc.client.on(\"user-published\",/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user,mediaType){var remoteVideoTrack,remoteAudioTrack;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return rtc.client.subscribe(user,mediaType);case 2:console.log(\"subscribe success\");// If the subscribed track is video.\nif(mediaType===\"video\"){// Get `RemoteVideoTrack` in the `user` object.\nremoteVideoTrack=user.videoTrack;remoteVideoTrack.play(\"agora_local\");// Or just pass the ID of the DIV container.\n// remoteVideoTrack.play(playerContainer.id);\n}props.dispatch(liveViewerUpdateStart({live_video_id:props.liveVideo.data.live_video_id}));// If the subscribed track is audio.\nif(mediaType===\"audio\"){// Get `RemoteAudioTrack` in the `user` object.\nremoteAudioTrack=user.audioTrack;// Play the audio track. No need to pass any DOM element.\nremoteAudioTrack.play();}case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}());_context2.next=5;return rtc.client.join(options.appId,options.channel,options.token||null,options.uid||null);case 5:uid=_context2.sent;if(!(options.role===\"host\")){_context2.next=16;break;}_context2.next=9;return AgoraRTC.createMicrophoneAudioTrack();case 9:rtc.localAudioTrack=_context2.sent;_context2.next=12;return AgoraRTC.createCameraVideoTrack();case 12:rtc.localVideoTrack=_context2.sent;// Publish the local audio and video tracks to the channel.\nrtc.localVideoTrack.play(\"agora_local\");_context2.next=16;return rtc.client.publish([rtc.localAudioTrack,rtc.localVideoTrack]);case 16:case\"end\":return _context2.stop();}}},_callee2);}));return _startBasicCall.apply(this,arguments);}function leaveCall(){return _leaveCall.apply(this,arguments);}function _leaveCall(){_leaveCall=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(options.role===\"host\")){_context3.next=7;break;}// Destroy the local audio and video tracks.\nrtc.localAudioTrack.close();rtc.localVideoTrack.close();// Traverse all remote users.\nrtc.client.remoteUsers.forEach(function(user){// Destroy the dynamically created DIV container.\nvar playerContainer=document.getElementById(user.uid);playerContainer&&playerContainer.remove();});props.dispatch(liveVideoEndStart({live_video_id:props.liveVideo.data.live_video_id}));_context3.next=10;break;case 7:_context3.next=9;return rtc.client.leave();case 9:window.location.assign(\"/live-videos\");case 10:case\"end\":return _context3.stop();}}},_callee3);}));return _leaveCall.apply(this,arguments);}function muteAudio(){return _muteAudio.apply(this,arguments);}function _muteAudio(){_muteAudio=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(rtc.localAudioTrack){_context4.next=2;break;}return _context4.abrupt(\"return\");case 2:if(!(localTrackState.audioTrackEnabled==true)){_context4.next=10;break;}_context4.next=5;return rtc.localAudioTrack.setEnabled(false);case 5:localTrackState.audioTrackEnabled=false;$(\"#mute-audio\").hide();$(\"#unmute-audio\").show();_context4.next=15;break;case 10:_context4.next=12;return rtc.localAudioTrack.setEnabled(true);case 12:localTrackState.audioTrackEnabled=true;$(\"#mute-audio\").show();$(\"#unmute-audio\").hide();case 15:case\"end\":return _context4.stop();}}},_callee4);}));return _muteAudio.apply(this,arguments);}function muteVideo(){return _muteVideo.apply(this,arguments);}function _muteVideo(){_muteVideo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(rtc.localVideoTrack){_context5.next=2;break;}return _context5.abrupt(\"return\");case 2:if(!(localTrackState.videoTrackEnabled==true)){_context5.next=10;break;}_context5.next=5;return rtc.localVideoTrack.setEnabled(false);case 5:localTrackState.videoTrackEnabled=false;$(\"#mute-video\").hide();$(\"#unmute-video\").show();_context5.next=15;break;case 10:_context5.next=12;return rtc.localVideoTrack.setEnabled(true);case 12:localTrackState.videoTrackEnabled=true;$(\"#mute-video\").show();$(\"#unmute-video\").hide();case 15:case\"end\":return _context5.stop();}}},_callee5);}));return _muteVideo.apply(this,arguments);}startBasicCall();return/*#__PURE__*/React.createElement(\"div\",{className:\"agora-card\"},/*#__PURE__*/React.createElement(\"div\",{id:\"agora_local\",style:{width:\"100%\",height:\"500px\"}}),/*#__PURE__*/React.createElement(\"div\",{className:\"button-group mt-3 mb-3\"},props.isOwner?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"live-action-icon-sec\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"list-unstyled live-action-flex\"},/*#__PURE__*/React.createElement(Media,{as:\"li\"},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return leaveCall();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/end-stream.png\",className:\"action-live-icon\"}))),/*#__PURE__*/React.createElement(Media,{as:\"li\",id:\"mute-audio\"},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return muteAudio();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/audio.png\",className:\"action-live-icon\"}))),/*#__PURE__*/React.createElement(Media,{as:\"li\",id:\"unmute-audio\",style:{display:\"none\"}},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return muteAudio();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/no-audio.png\",className:\"action-live-icon\"}))),/*#__PURE__*/React.createElement(Media,{as:\"li\",id:\"mute-video\"},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return muteVideo();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/video.png\",className:\"action-live-icon\"}))),/*#__PURE__*/React.createElement(Media,{as:\"li\",id:\"unmute-video\",style:{display:\"none\"}},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return muteVideo();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/mute-video.png\",className:\"action-live-icon\"})))))):/*#__PURE__*/React.createElement(\"div\",{className:\"live-action-icon-sec\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"list-unstyled live-action-flex\"},/*#__PURE__*/React.createElement(Media,{as:\"li\"},/*#__PURE__*/React.createElement(Link,{to:\"#\",onClick:function onClick(){return leaveCall();}},/*#__PURE__*/React.createElement(Image,{src:window.location.origin+\"/assets/images/icons/end-stream.png\",className:\"action-live-icon\"})))))));};var mapStateToPros=function mapStateToPros(state){return{liveVideo:state.liveVideo.singleLiveVideo};};function mapDispatchToProps(dispatch){return{dispatch:dispatch};}export default connect(mapStateToPros,mapDispatchToProps)(translate(AgoraLive));","map":{"version":3,"sources":["/home/codegama/bhawya/source_code/fx-frontend-base/src/components/Sample/AgoraLive.jsx"],"names":["React","useEffect","useState","connect","translate","t","Link","AgoraRTC","Form","Button","Container","Row","Col","Table","Media","Image","liveViewerUpdateStart","liveVideoEndStart","configuration","client","createClient","mode","codec","$","window","AgoraLive","props","rtc","localAudioTrack","localVideoTrack","localTrackState","videoTrackEnabled","audioTrackEnabled","options","appId","get","uid","isOwner","channel","liveVideo","data","virtual_id","token","agora_token","role","remoteUsers","startBasicCall","setClientRole","on","user","mediaType","subscribe","console","log","remoteVideoTrack","videoTrack","play","dispatch","live_video_id","remoteAudioTrack","audioTrack","join","createMicrophoneAudioTrack","createCameraVideoTrack","publish","leaveCall","close","forEach","playerContainer","document","getElementById","remove","leave","location","assign","muteAudio","setEnabled","hide","show","muteVideo","width","height","origin","display","mapStateToPros","state","singleLiveVideo","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport { translate, t } from \"react-multi-lang\";\nimport { Link } from \"react-router-dom\";\nimport AgoraRTC from \"agora-rtc-sdk-ng\";\nimport { Form, Button, Container, Row, Col,Table, Media, Image } from \"react-bootstrap\";\nimport {\n  liveViewerUpdateStart,\n  liveVideoEndStart,\n} from \"../../store/actions/LiveVideoAction\";\nimport configuration from \"react-global-configuration\";\nconst client = AgoraRTC.createClient({ mode: \"live\", codec: \"vp8\" });\nconst $ = window.$;\n\nconst AgoraLive = (props) => {\n\n    var rtc = {\n        // For the local client.\n        client: null,\n        // For the local audio and video tracks.\n        localAudioTrack: null,\n        localVideoTrack: null,\n    };\n    \n    const localTrackState = {\n      videoTrackEnabled: true,\n      audioTrackEnabled: true\n    }\n\n    var options = {\n        // Pass your app ID here.\n        appId: configuration.get(\"configData.agora_app_id\"),\n        // set UID\n        uid: props.isOwner ? 1 : 0,\n        // Set the channel name.\n        channel: props.liveVideo.data.virtual_id,\n        // Pass a token if your project enables the App Certificate.\n        token: props.liveVideo.data.agora_token ? props.liveVideo.data.agora_token : null,\n        // Set the user role in the channel. // \"audience\"\n        role: props.isOwner ? \"host\" : \"audience\"\n    };\n\n    var remoteUsers = {};\n  \n    async function startBasicCall() {\n        rtc.client = AgoraRTC.createClient({ mode: \"rtc\", codec: \"vp8\" });\n        client.setClientRole(options.role);\n\n        rtc.client.on(\"user-published\", async (user, mediaType) => {\n            // Subscribe to a remote user.\n            await rtc.client.subscribe(user, mediaType);\n            console.log(\"subscribe success\");\n          \n            // If the subscribed track is video.\n            if (mediaType === \"video\") {\n              // Get `RemoteVideoTrack` in the `user` object.\n              const remoteVideoTrack = user.videoTrack;\n              \n              remoteVideoTrack.play(\"agora_local\");\n              // Or just pass the ID of the DIV container.\n              // remoteVideoTrack.play(playerContainer.id);\n            }\n            \n            props.dispatch(\n              liveViewerUpdateStart({\n                  live_video_id:props.liveVideo.data.live_video_id,\n              })\n            );\n          \n            // If the subscribed track is audio.\n            if (mediaType === \"audio\") {\n              // Get `RemoteAudioTrack` in the `user` object.\n              const remoteAudioTrack = user.audioTrack;\n              // Play the audio track. No need to pass any DOM element.\n              remoteAudioTrack.play();\n            }\n        });\n\n        const uid = await rtc.client.join(options.appId, options.channel, options.token || null, options.uid || null);\n\n        if (options.role === \"host\") {\n\n            // Create an audio track from the audio sampled by a microphone.\n            rtc.localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();\n            // Create a video track from the video captured by a camera.\n            rtc.localVideoTrack = await AgoraRTC.createCameraVideoTrack();\n            // Publish the local audio and video tracks to the channel.\n            rtc.localVideoTrack.play(\"agora_local\");\n\n            await rtc.client.publish([rtc.localAudioTrack, rtc.localVideoTrack]);\n        }\n        \n        \n    }\n\n    async function leaveCall() {\n\n      if (options.role === \"host\") {\n        // Destroy the local audio and video tracks.\n        rtc.localAudioTrack.close();\n        rtc.localVideoTrack.close();\n    \n        // Traverse all remote users.\n        rtc.client.remoteUsers.forEach(user => {\n          // Destroy the dynamically created DIV container.\n          const playerContainer = document.getElementById(user.uid);\n          playerContainer && playerContainer.remove();\n        });\n        props.dispatch(\n          liveVideoEndStart({\n              live_video_id:props.liveVideo.data.live_video_id,\n          })\n        );\n      } else {\n        // Leave the channel.\n        await rtc.client.leave();\n        window.location.assign(\"/live-videos\");\n      } \n    }\n\n    async function muteAudio() {\n      if (!rtc.localAudioTrack) return;\n      if(localTrackState.audioTrackEnabled == true) {\n        await rtc.localAudioTrack.setEnabled(false);\n        localTrackState.audioTrackEnabled = false;\n        $(\"#mute-audio\").hide();\n        $(\"#unmute-audio\").show();\n      } else {\n        await rtc.localAudioTrack.setEnabled(true);\n        localTrackState.audioTrackEnabled = true;\n        $(\"#mute-audio\").show();\n        $(\"#unmute-audio\").hide();\n      }\n    }\n\n    async function muteVideo() {\n      if (!rtc.localVideoTrack) return;\n      if(localTrackState.videoTrackEnabled == true) {\n        await rtc.localVideoTrack.setEnabled(false);\n        localTrackState.videoTrackEnabled = false;\n        $(\"#mute-video\").hide();\n        $(\"#unmute-video\").show();\n      } else {\n        await rtc.localVideoTrack.setEnabled(true);\n        localTrackState.videoTrackEnabled = true;\n        $(\"#mute-video\").show();\n        $(\"#unmute-video\").hide();\n      }\n    }\n    \n    startBasicCall();\n\n    return (\n        <div className=\"agora-card\">\n            <div id=\"agora_local\" style={{ width: \"100%\", height: \"500px\" }} />\n            <div className=\"button-group mt-3 mb-3\">\n              \n              {props.isOwner ? \n              <>\n                <div className=\"live-action-icon-sec\">\n                  <ul className=\"list-unstyled live-action-flex\">\n                    <Media as=\"li\">\n                      <Link to=\"#\" \n                        onClick={() =>\n                          leaveCall()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/end-stream.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                    <Media as=\"li\" id=\"mute-audio\">\n                      <Link to=\"#\"\n                      onClick={() =>\n                        muteAudio()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/audio.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                    <Media as=\"li\" id=\"unmute-audio\" style={{display: \"none\"}}>\n                      <Link to=\"#\"\n                      onClick={() =>\n                        muteAudio()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/no-audio.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                    <Media as=\"li\" id=\"mute-video\">\n                      <Link to=\"#\"\n                      onClick={() =>\n                        muteVideo()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/video.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                    <Media as=\"li\" id=\"unmute-video\" style={{display: \"none\"}}>\n                      <Link to=\"#\"\n                      onClick={() =>\n                        muteVideo()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/mute-video.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                  </ul>\n                </div>\n              </>\n                :\n                <div className=\"live-action-icon-sec\">\n                  <ul className=\"list-unstyled live-action-flex\">\n                    <Media as=\"li\">\n                      <Link to=\"#\" \n                        onClick={() =>\n                          leaveCall()\n                      }>\n                        <Image\n                          src={\n                            window.location.origin + \"/assets/images/icons/end-stream.png\"\n                          }\n                          className=\"action-live-icon\"\n                        />\n                      </Link>\n                    </Media>\n                  </ul>\n                </div>\n              }\n              \n              \n            </div>\n        </div>\n        \n    );\n};\n\n\nconst mapStateToPros = (state) => ({\n  liveVideo: state.liveVideo.singleLiveVideo,\n});\n\nfunction mapDispatchToProps(dispatch) {\nreturn { dispatch };\n}\n\nexport default connect(mapStateToPros, mapDispatchToProps)(translate(AgoraLive));"]},"metadata":{},"sourceType":"module"}